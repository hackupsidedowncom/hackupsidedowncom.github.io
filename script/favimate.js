const favimate = () => {
	const favi = document.querySelector('link[rel*="icon"]')
	if(!favi) {
		return
	}
	const canvas = document.createElement('canvas')
	canvas.hidden = 'hidden'
	canvas.width = 32
	canvas.height = 32
	document.body.appendChild(canvas)
	const ctx = canvas.getContext("2d")
	const scaleMax = 2
	const scaleDelta = 0.15
	const img = new Image()
	img.onload = () => ani(animate)
	// img.src = "anonmask.png"
	img.src = "data:image/png;base64,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"

	let scale = 1
	let scaleDirection = -1
	let aniTime

	//	We animate with a timeout, as the favicon is limited to how quickly it needs to be updated.
	const ani = (func, time = 200) => {
		clearTimeout(aniTime)
		func()
		aniTime = setTimeout(() => ani(func, time), time)
	}

	const animate = () => {
		const draw = (scale, x = 16, y = 16) => {
			ctx.clearRect(0, 0, canvas.width, canvas.height)
			ctx.translate(x, y)
			ctx.scale(scale, scale)
			ctx.drawImage(img, -img.width / 2, -img.height / 2)
			ctx.setTransform(1, 0, 0, 1, 0, 0)
		}
		draw(scale)
		scale += scaleDirection * scaleDelta
		if (scale < -scaleMax || scale > scaleMax) {
			scaleDirection *= -1
			scale += scaleDirection * scaleDelta
		}
		favi.href = canvas.toDataURL('image/png')
	}
}
favimate()
